<!doctype html>
<html lang="en" dir="ltr">
<head>
    <title>My Material-UI example page</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width, shrink-to-fit=no" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/4.4.1/css/ionicons.min.css" />
    <style>
        .root {
            padding: 10px;
        }
        .paper {
            max-height: 90%;
            max-width: 800px;
            padding: 40px;
            overflow: auto;
        }
        .a-img-list {
            width: 30px;
            height: 34px;
        }
        .a-img-box-list {
            padding: 10px;
            float: left;
            border-right: 1px solid gray;
        }
        .a-left-list {
            padding: 10px;
            float: left;
        }
        .a-d-img {
            padding: 10px;
            float: left;
        }
        .a-d-born {
            padding: 10px;
            float: left;
        }
        .a-d-born-label {
            padding: 10px;
            font-weight: bold;
            font-size: small;
        }
        .a-d-born-text {
            padding: 10px;
            float: left;
        }
        .li-title {
            padding: 10px;
            float: left;
            font-weight: bold;
            cursor: pointer;
        }
        .li-id {
            padding: 10px;
            float: right;
            font-size: 9px;
        }
        .li-clear {
            clear: both;
        }
        .li-c-title {
            padding: 4px;
            float: left;
            font-weight: bold;
            cursor: pointer;
        }
        .li-c-id {
            padding: 4px;
            float: right;
            font-size: 9px;
        }
        .bar {
            margin-bottom: 20px;
        }
        .bar-arrow-left {
            padding: 15px 0px;
            float: left;
            cursor: pointer;
        }
        .bar-arrow-left-img {
            width: 30px;
            height: 20px;
        }
        .bar-title {
            padding: 10px;
            float: left;
            font-size: x-large;
            font-weight: bold;
        }
        .bar-id {
            padding: 10px;
            float: right;
            font-size: 9px;
        }
        .rc-box {
            border-left: 1px solid gray;
            margin: 0.5em 1em;
        }
        .rc-ref {
            font-style: italic;
            font-size: 0.75em;
            padding-left: 10px;
        }
        .rc-ref-pointer {
            font-style: italic;
            font-size: 0.75em;
            padding-left: 10px;
            cursor: pointer;
        }
        .rc-content {
            padding-left: 20px;
        }
        .alias-label {
            float: left;
            font-weight: bold;
            padding-right: 10px;
        }
        .alias-text-box {
            float: left;
            border-left: 1px solid gray;
            padding-left: 10px;
        }
        .alias-text {
            font-style: italic;
            font-size: 0.75em;
        }
        .abstract-title {
            font-weight: bold;
        }
        .abstract-box {
            margin-top: 20px;
            padding: 20px;
        }
        .quote-comment-box {
            background-color: #dedede;
            margin-top: 10px;
            padding: 10px;
            font-size: 0.85em;
            font-style: normal;
        }
        .quotes-title {
            font-weight: bold;
        }
        .quotes-box {
            margin-top: 20px;
            padding: 20px;
        }
        .quotes-concept-id {
            font-size: 0.75em;
        }
        .info-box {
            margin-top: 20px;
            padding: 20px;
        }
        .info-item-box {
            border-bottom: 1px solid #ededed;
        }
        .info-item-label {
            font-size: 0.75em;
        }
        .info-item-text {
            font-style: italic;
        }
        @media (min-width:1024px) {
            .info-box {
                width: 50%;
                padding: 40px;
            }
            .abstract-box {
                width: 50%;
                padding: 40px;
            }
            .quotes-box {
                width: 50%;
                padding: 40px;
            }
        }
        blockquote {
            border-left: 3px solid #00CC8F;
            color: #1a1a1a;
            font-style: italic;
            padding: 1em 2em;
            position: relative;
            -webkit-transition: .2s border ease-in-out;
            -moz-transition: .2s border ease-in-out;
            -o-transition: .2s border ease-in-out;
            transition: .2s border ease-in-out;
            z-index: 0;
        }
        blockquote:before {
            content: "";
            position: absolute;
            top: 50%;
            left: -4px;
            height: 2em;
            background-color: #fff;
            width: 5px;
            margin-top: -1em;
        }
        blockquote:after {
            content: "\f35f";
            position: absolute;
            top: 50%;
            left: -0.5em;
            color: $color;
            font-family: "Ionicons";
            font-style: normal;
            line-height: 1em;
            text-align: center;
            text-indent: -2px;
            width: 1em;
            margin-top: -0.5em;
            -webkit-transition: .2s all ease-in-out, .4s transform ease-in-out;
            -moz-transition: .2s all ease-in-out, .4s transform ease-in-out;
            -o-transition: .2s all ease-in-out, .4s transform ease-in-out;
            transition: .2s all ease-in-out, .4s transform ease-in-out;
        }
        cite {
            display: block;
            font-size: 0.75em;
            line-height: 1.8em;
            margin-top: 1em;
        }
        
    </style>
</head>
<body>
    <div id="root"></div>
    <script src="https://unpkg.com/react@latest/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@latest/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@material-ui/core/umd/material-ui.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@latest/babel.min.js"></script>
    <script src="https://unpkg.com/react-router-dom/umd/react-router-dom.min.js"></script>
    <script src="./assets/js/classnames/classnames.js"></script>
    <script type="text/babel">
        function loadJSON(jsonpath, callback) {
            var xobj = new XMLHttpRequest();
            xobj.overrideMimeType("application/json");
            xobj.open('GET', jsonpath, true);
            xobj.onreadystatechange = function() {
                if (xobj.readyState == 4 && xobj.status == "200") {
                    // .open will NOT return a value but simply returns undefined in async mode so use a callback
                    callback(xobj.responseText);
                }
            };
            xobj.send(null);
        }
        function compareById(a, b) {
            if (a.id < b.id) {
                return -1;
            }
            if (a.id > b.id) {
                return 1;
            }
            return 0;
        }
        function compareByDatePub(a, b) {
            if (a.datepub < b.datepub) {
                return -1;
            }
            if (a.datepub > b.datepub) {
                return 1;
            }
            return 0;
        }
        function compareQuotes(a, b) {
            var pageA = a.quote.page;
            var pageB = b.quote.page;
            if (pageA < pageB) {
                return -1;
            }
            if (pageA > pageB) {
                return 1;
            }
            return 0;
        }
    </script>
    <script type="text/babel">
        function dbGetArticleQuotes(id, dbParam) {
            var quotes = [];
            var i, i_items=dbParam.concepts, i_len=dbParam.concepts.length, c;
            for (i=0; i<i_len; i++) {
                c = dbParam.concepts[i];
                if (c.contents) {
                    var j, j_items=c.contents, j_len=c.contents.length, item;
                    for (j=0; j<j_len; j++) {
                        item = c.contents[j];
                        if (item.quote && item.quote.article == id) {
                            console.log('dbGetArticleQuotes', c.id);
                            quotes.push({
                                concept: c, 
                                quote: item.quote
                            });
                        }
                    }
                }
            }
            return quotes;
        }
        function dbGetById(coll, id) {
            return coll.find((item) => {
                    return item.id == id;
                });
        }
        function dbGetAuthor(id, dbParam) {
            var db = dbParam || gJsonData;
            console.log('dbGetAuthor', id);
            return dbGetById(db.authors, id);
        }
        function dbGetConcept(id, dbParam) {
            var db = dbParam || gJsonData;
            return dbGetById(db.concepts, id);
        }
        function dbGetArticle(id, dbParam) {
            var db = dbParam || gJsonData;
            return dbGetById(db.articles, id);
        }
        function dbGetBook(id, dbParam) {
            var db = dbParam || gJsonData;
            return dbGetById(db.books, id);
        }
        function dbGetAuthors(authorIdColl, dbParam) {
            var db = dbParam || gJsonData;
            var authorObjColl = [];
            var i, i_items=authorIdColl, i_len=authorIdColl.length, item;
            for (i=0; i<i_len; i++) {
                item = authorIdColl[i];
                var aObj = dbGetAuthor(item, dbParam);
                if (!aObj) {
                    aObj = {
                        id: item.id, 
                        fullname: 'missing author info'
                    };
                }
                authorObjColl.push(aObj);
            }
            return authorObjColl;
        }
        function dbExtractTitleText(title, defaultValue) {
            if (!title) {
                return defaultValue;
            }
            return title.text || defaultValue;
        }
    </script>
    <script type="text/babel">
        console.log("MaterialUI", MaterialUI);
        const ReactRouterDOM = window.ReactRouterDOM;
        const classnames = window.classNames;
        const {
            colors, 
            createGenerateClassName, 
            createMuiTheme, 
            createStyles, 
            fade, 
            makeStyles, 
            jssPreset, 
            MuiThemeProvider, 
            withStyles, 
            withTheme, 
            AppBar, 
            Avatar, 
            Backdrop, 
            Badge, 
            BottomNavigation, 
            BottomNavigationAction, 
            Button, 
            ButtonBase, 
            Card, 
            CardActionArea, 
            CardActions, 
            CardContent, 
            CardHeader, 
            CardMedia, 
            Checkbox, 
            Chip, 
            CircularProgress, 
            ClickAwayListener, 
            Collapse, 
            CssBaseline, 
            Dialog, 
            DialogActions, 
            DialogContent, 
            DialogContentText, 
            DialogTitle, 
            Divider, 
            Drawer, 
            ExpansionPanel, 
            ExpansionPanelActions, 
            ExpansionPanelDetails, 
            ExpansionPanelSummary, 
            Fab, 
            Fade, 
            FilledInput, 
            FormControl, 
            FormControlLabel, 
            FormGroup, 
            FormHelperText, 
            FormLabel, 
            Grid, 
            GridList, 
            GridListTile, 
            GridListTileBar, 
            Grow, 
            Hidden, 
            Icon, 
            IconButton, 
            Input, 
            InputAdornment, 
            InputBase, 
            InputLabel, 
            LinearProgress, 
            Link, 
            List, 
            ListItem, 
            ListItemAvatar, 
            ListItemIcon, 
            ListItemSecondaryAction, 
            ListItemText, 
            ListSubheader, 
            Menu, 
            MenuItem, 
            MenuList, 
            MobileStepper, 
            Modal, 
            ModalManager, 
            NativeSelect, 
            NoSsr, 
            OutlinedInput, 
            Paper, 
            Popover, 
            Popper, 
            Portal, 
            Radio, 
            RadioGroup, 
            RootRef, 
            Select, 
            Slide, 
            Snackbar, 
            SnackbarContent, 
            Step, 
            StepButton, 
            StepConnector, 
            StepContent, 
            StepIcon, 
            StepLabel, 
            Stepper, 
            SvgIcon, 
            SwipeableDrawer, 
            Switch, 
            Tab, 
            Table, 
            TableBody, 
            TableCell, 
            TableFooter, 
            TableHead, 
            TablePagination, 
            TableRow, 
            TableSortLabel, 
            Tabs, 
            TextField, 
            Toolbar, 
            Tooltip, 
            Typography, 
            withMobileDialog, 
            withWidth, 
            Zoom
        } = MaterialUI;
        const drawerWidth = 240;
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        const theme = createMuiTheme({
            palette: {
                primary: {
                    light: colors.purple[300], 
                    main: colors.purple[500], 
                    dark: colors.purple[700]
                }, 
                secondary: {
                    light: colors.yellow[300], 
                    main: colors.yellow[500], 
                    dark: colors.yellow[700]
                }
            }, 
            typography: {
                useNextVariants: true
            }
        });
        function DetailBar(props) {
            var {title, id, showFullBar, onClick} = props;
            return  (
                    <div className="bar">
                    {
                        showFullBar &&  (
                            <div className="bar-arrow-left" onClick={onClick}>
                                <img src={'./assets/img/arrow-left.png'} className="bar-arrow-left-img">
                                </img>
                            
                            </div>
                        )
                        
                    }{
                        showFullBar &&  (
                            <div className="bar-title">
                            {title}</div>
                        )
                        
                    }<div className="bar-id">
                        id: {id}
                        </div>
                    
                        <div className="li-clear">
                        </div>
                    
                    </div>
                )
            ;
        }
        function Quote(props) {
            var {item, jsonData} = props;
            var page = null;
            // log 'Quote', item
            if (item.page) {
                page = 'pag. ' + item.page;
            }
            else if (item.epage) {
                page = 'kindle pag. ' + item.epage;
            }
            else if (item.eloc) {
                page = 'kindle loc. ' + item.eloc;
            }
            return  (
                    <blockquote>
                    {
                        item.lines.map(function(token, i) {
                            if (token.quote) {
                                return  (
                                        <Quote key={i} item={token.quote} jsonData={jsonData}>
                                        </Quote>
                                    )
                                ;
                            }
                            else {
                                return  (
                                        <p key={i}>
                                        {token}
                                        </p>
                                    )
                                ;
                            }
                        })
                    }<cite>
                        {
                            item.article && item.article.length > 0 &&  (
                                <QuoteArticle id={item.article} page={page} jsonData={jsonData}>
                                </QuoteArticle>
                            )
                            
                        }{
                            item.book && item.book.length > 0 &&  (
                                <QuoteBook id={item.book} page={page} jsonData={jsonData}>
                                </QuoteBook>
                            )
                            
                        }</cite>
                    
                    {
                        item.comment &&  (
                            <div className="quote-comment-box">
                                <ContentText item={item.comment} jsonData={jsonData}>
                                </ContentText>
                            
                            </div>
                        )
                        
                    }</blockquote>
                )
            ;
        }
        function QuoteArticle(props) {
            var {id, page, jsonData} = props;
            var title = id, author = null;
            // log 'QuoteArticle', id, page
            var articleObj = dbGetArticle(id, jsonData);
            // log 'QuoteArticle.articleObj', articleObj
            if (articleObj) {
                var authorsObj = dbGetAuthors(articleObj.authors, jsonData);
                var titleText = dbExtractTitleText(articleObj.title);
                title = titleText || articleObj.url || articleObj.id;
                // log 'QuoteArticle.title', title
                if (authorsObj.length > 0) {
                    author = authorsObj[0].fullname;
                }
                else {
                    if (authorsObj.book) {
                        var bookObj = dbGetBook(authorsObj.book, jsonData);
                        if (bookObj) {
                            var authorsObj = dbGetAuthors(bookObj.authors, jsonData);
                            if (authorsObj.length > 0) {
                                author = authorsObj[0].fullname;
                            }
                        }
                    }
                    else {
                        author = 'missing author';
                    }
                }
            }
            else {
                title = 'missing article: '+ title;
                author = 'missing author';
            }
            return  (
                    <div>
                    {author}, {title} {page && ','} {page}
                    </div>
                )
            ;
        }
        function QuoteBook(props) {
            var {id, page, jsonData} = props;
            var title = id, author = null;
            var bookObj = dbGetBook(id, jsonData);
            // log 'QuoteBook', id, page
            if (bookObj) {
                // log 'QuoteBook.bookObj.authors', bookObj.authors
                var authorsObj = dbGetAuthors(bookObj.authors, jsonData);
                // log 'QuoteBook.authorsObj', authorsObj
                var titleText = dbExtractTitleText(bookObj.title);
                title = titleText || bookObj.url || bookObj.id;
                if (authorsObj.length > 0) {
                    author = authorsObj[0].fullname;
                }
                else {
                    author = 'missing author';
                }
            }
            else {
                title = title + ' missing article';
                author = 'missing author';
            }
            return  (
                    <div>
                    {author}, {title} {page && ','} {page}
                    </div>
                )
            ;
        }
        function RConcept(props) {
            var {item, jsonData, handleOpen} = props;
            var {id} = item;
            var conceptObj = dbGetConcept(id, jsonData);
            // log 'RConcept.conceptObj', id, conceptObj
            var conceptTitle = conceptObj ? dbExtractTitleText(conceptObj.title) : 'missing concept: ' + id;
            return  (
                    <div className="rc-box">
                        <div>
                            <div className={conceptObj ? 'rc-ref-pointer' : 'rc-ref'} onClick={(ev) => {
                                if (conceptObj) {
                                    handleOpen(ev, conceptObj);
                                }
                            }}>
                                <span>
                                Si veda il concetto &nbsp;
                                </span>
                            
                                <span>
                                {conceptTitle}
                                </span>
                            
                            </div>
                        
                        </div>
                    
                        <div className="rc-content">
                            <ContentText item={item} jsonData={jsonData}>
                            </ContentText>
                        
                        </div>
                    
                    </div>
                )
            ;
        }
        function RArticle(props) {
            var {item, jsonData, handleOpen} = props;
            var {id} = item;
            var articleObj = dbGetArticle(id, jsonData);
            console.log('RArticle.articleObj', id, articleObj);
            var articleTitle = articleObj ? dbExtractTitleText(articleObj.title) : 'missing article: ' + id;
            return  (
                    <div className="rc-box">
                        <div>
                            <div className={articleObj ? 'rc-ref-pointer' : 'rc-ref'} onClick={(ev) => {
                                if (articleObj) {
                                    handleOpen(ev, articleObj);
                                }
                            }}>
                                <span>
                                Si veda l'articolo &nbsp;
                                </span>
                            
                                <span>
                                {articleTitle}
                                </span>
                            
                            </div>
                        
                        </div>
                    
                        <div className="rc-content">
                            <ContentText item={item} jsonData={jsonData}>
                            </ContentText>
                        
                        </div>
                    
                    </div>
                )
            ;
        }
        function ContentText(props) {
            var {item, jsonData, handleOpen} = props;
            if (item.contents && item.contents.length > 0) {
                return  (
                        <div>
                        {
                            item.contents.map(function(token, i) {
                                if (token.line) {
                                    return  (
                                            <p key={i}>
                                            {token.line}
                                            </p>
                                        )
                                    ;
                                }
                                else if (token.quote) {
                                    return  (
                                            <Quote key={i} item={token.quote} jsonData={jsonData}>
                                            </Quote>
                                        )
                                    ;
                                }
                                else if (token.kind == "rconcept") {
                                    return  (
                                            <RConcept key={i} item={token} handleOpen={handleOpen} jsonData={jsonData}>
                                            </RConcept>
                                        )
                                    ;
                                }
                                else if (token.kind == "rarticle") {
                                    return  (
                                            <RArticle key={i} item={token} handleOpen={handleOpen} jsonData={jsonData}>
                                            </RArticle>
                                        )
                                    ;
                                }
                            })
                        }</div>
                    )
                ;
            }
            else {
                return null;
            }
        }
        function FieldList(props) {
            var {jsonData} = props;
            return  (
                    <div>
                        <h2>
                        Campi
                        </h2>
                    
                        <Paper style={{maxHeight: 370, overflow: 'auto'}}>
                            <Table>
                            {
                                jsonData.fields.sort(compareById).map(function(item) {
                                    return  (
                                            <TableRow button key={item.id}>
                                                <TableCell>
                                                    <h3>
                                                    {item.id}
                                                    </h3>
                                                
                                                    <ContentText item={item}>
                                                    </ContentText>
                                                
                                                </TableCell>
                                            
                                            </TableRow>
                                        )
                                    ;
                                })
                            }</Table>
                        
                        </Paper>
                    
                    </div>
                )
            ;
        }
        function Field(props) {
            var {item} = props;
            return  (
                    <div>
                        <h3>
                        {item.id}
                        </h3>
                    
                        <ContentText item={item}>
                        </ContentText>
                    
                    </div>
                )
            ;
        }
        function SchoolList(props) {
            var {jsonData} = props;
            return  (
                    <div>
                        <h2>
                        Scuole
                        </h2>
                    
                        <Paper style={{maxHeight: 370, overflow: 'auto'}}>
                            <Table>
                            {
                                jsonData.approaches.sort(compareById).map(function(item) {
                                    return  (
                                            <TableRow button key={item.id}>
                                                <TableCell>
                                                    <h3>
                                                    {item.id}
                                                    </h3>
                                                
                                                    <ContentText item={item}>
                                                    </ContentText>
                                                
                                                </TableCell>
                                            
                                            </TableRow>
                                        )
                                    ;
                                })
                            }</Table>
                        
                        </Paper>
                    
                    </div>
                )
            ;
        }
        function School(props) {
            var {item} = props;
            return  (
                    <div>
                        <h3>
                        {item.id}
                        </h3>
                    
                        <ContentText item={item}>
                        </ContentText>
                    
                    </div>
                )
            ;
        }
        function TheoryList(props) {
            var {jsonData} = props;
            return  (
                    <div>
                        <h2>
                        Teorie
                        </h2>
                    
                        <Paper style={{maxHeight: 370, overflow: 'auto'}}>
                            <Table>
                            {
                                jsonData.theories.sort(compareById).map(function(item) {
                                    return  (
                                            <TableRow button key={item.id}>
                                                <TableCell>
                                                    <h3>
                                                    {item.id}
                                                    </h3>
                                                
                                                    <ContentText item={item}>
                                                    </ContentText>
                                                
                                                </TableCell>
                                            
                                            </TableRow>
                                        )
                                    ;
                                })
                            }</Table>
                        
                        </Paper>
                    
                    </div>
                )
            ;
        }
        function Theory(props) {
            var {item} = props;
            return  (
                    <div>
                        <h3>
                        {item.id}
                        </h3>
                    
                        <ContentText item={item}>
                        </ContentText>
                    
                    </div>
                )
            ;
        }
        class ConceptList extends React.Component {
            state = {
                status: 'list', 
                selectedItem: null, 
                scrollTop: 0, 
                scrollingElement: null, 
                justRenderedList: false, 
                justRenderedItem: false, 
                forms: [
                    
                ], 
                current: {
                    status: 'list', 
                    selectedItem: null, 
                    scrollTop: 0, 
                    scrollingElement: null, 
                    justRenderedList: false, 
                    depth: 0, 
                    title: 'Concetti'
                }
            };
            componentDidMount() {
                window.addEventListener('scroll', this.handlePaperScroll);
                this.props.onChangeCurrent(this.state.current, this.handleConceptClose, this.handleChangeSearch);
            }
            componentWillUnmount() {
                window.removeEventListener('scroll', this.handlePaperScroll);
            }
            componentDidUpdate(prevProps, prevState) {
                if (this.state.current.justRenderedList) {
                    if (this.state.current.scrollingElement) {
                        this.state.current.scrollingElement.scrollTo(0, this.state.current.scrollTop);
                        this.setState((prevState) => {
                            return {
                                    ...prevState, 
                                    current: {
                                        ...prevState.current, 
                                        justRenderedList: false
                                    }
                                };
                        });
                    }
                }
                if (this.state.current.justRenderedItem) {
                    if (this.state.current.scrollingElement) {
                        this.state.current.scrollingElement.scrollTo(0, 0);
                        this.setState((prevState) => {
                            return {
                                    ...prevState, 
                                    current: {
                                        ...prevState.current, 
                                        justRenderedItem: false
                                    }
                                };
                        });
                    }
                }
            }
            handlePaperScroll = (ev) => {
                if (this.state.current.status == 'list') {
                    if (ev.target.scrollingElement) {
                        this.setState((prevState) => {
                            return {
                                    ...prevState, 
                                    current: {
                                        ...prevState.current, 
                                        scrollTop: event.target.scrollingElement.scrollTop, 
                                        scrollingElement: event.target.scrollingElement
                                    }
                                };
                        });
                    }
                }
            }
            handleConceptClose = () => {
                this.setState((prevState) => {
                    var current = prevState.forms.pop();
                    if (current.status == 'list') {
                        current.justRenderedList = true;
                        current.depth = prevState.forms.length;
                        current.title = 'Concetti';
                        current.selectedItem = null;
                    }
                    this.props.onChangeCurrent(current, this.handleConceptClose, this.handleChangeSearch);
                    return {
                            ...prevState, 
                            current: current
                        };
                });
            }
            handleChangeSearch = (ev) => {
                var search = ev.target.value;
                this.setState((prevState) => {
                    return {
                            ...prevState, 
                            current: {
                                ...prevState.current, 
                                searchText: search
                            }
                        };
                });
            }
            handleConceptOpen = (ev, selectedItem) => {
                // log 'handleConceptOpen.id', selectedItem.id
                // log 'handleConceptOpen.ev', ev
                this.setState((prevState) => {
                    console.log('handleConceptOpen');
                    prevState.forms.push(prevState.current);
                    var current = {
                        ...prevState.current, 
                        status: 'concept', 
                        selectedItem: selectedItem, 
                        depth: prevState.forms.length, 
                        title: (selectedItem.title && selectedItem.title.text) || selectedItem.id, 
                        justRenderedItem: true
                    };
                    this.props.onChangeCurrent(current, this.handleConceptClose, this.handleChangeSearch);
                    console.log('onChangeCurrent called');
                    return {
                            ...prevState, 
                            current: current
                        };
                });
            }
            render() {
                const {
                    jsonData,
                    onChangeCurrent
                } = this.props;
                const {
                    status, 
                    selectedItem, 
                    searchText
                } = this.state.current;
                console.log('ConceptList: status,selectedItem,searchText', status, selectedItem, searchText);
                return  (
                        <div>
                            <Paper className="paper">
                            {
                                status == 'list' &&  (
                                    <div>
                                    {
                                        jsonData.concepts.sort(compareById).map((item) => {
                                            if ((!searchText || searchText.length == 0) || item.id.indexOf(searchText) > -1) {
                                                return  (
                                                        <ConceptListItem key={item.id} item={item} onClick={this.handleConceptOpen}>
                                                        </ConceptListItem>
                                                    )
                                                ;
                                            }
                                        })
                                    }</div>
                                )
                                
                            }{
                                status == 'concept' &&  (
                                    <div>
                                        <DetailBar title={(selectedItem.title && selectedItem.title.text) || selectedItem.id} id={selectedItem.id} showFullBar={false} onClick={() =>
                                            this.handleConceptClose()}>
                                        </DetailBar>
                                    
                                        <Concept item={selectedItem} jsonData={jsonData} handleOpen={this.handleConceptOpen}>
                                        </Concept>
                                    
                                    </div>
                                )
                                
                            }</Paper>
                        
                        </div>
                    )
                ;
            }
        }
        function ConceptListItem(props) {
            var {item, onClick} = props;
            var {id, name, title} = item;
            title = title && title.text ? title.text : name;
            return  (
                    <div onClick={(event) =>
                        onClick(event, item)}>
                        <div className="li-c-title">
                        {title}
                        </div>
                    
                        <div className="li-c-id">
                        id: {id}
                        </div>
                    
                        <div className="li-clear">
                        </div>
                    
                    </div>
                )
            ;
        }
        function Concept(props) {
            var {item, handleOpen, jsonData} = props;
            var {id, name, title} = item;
            title = (title || name);
            return  (
                    <div>
                    {
                        item.aliases && item.aliases.length > 0 &&  (
                            <Aliases item={item}>
                            </Aliases>
                        )
                        
                    }<ContentText item={item} jsonData={jsonData} handleOpen={handleOpen}>
                        </ContentText>
                    
                    </div>
                )
            ;
        }
        function Aliases(props) {
            var {item} = props;
            return  (
                    <div className="alias-box">
                        <div className="alias-label">
                        alias
                        </div>
                    
                        <div className="alias-text-box">
                        {
                            item.aliases.map((item, i) => {
                                return  (
                                        <div className="alias-text" key={i}>
                                        {item.text}
                                        </div>
                                    )
                                ;
                            })
                        }</div>
                    
                        <div className="li-clear">
                        </div>
                    
                    </div>
                )
            ;
        }
        class AuthorList extends React.Component {
            state = {
                status: 'list', 
                selectedItem: null, 
                scrollTop: 0, 
                scrollingElement: null, 
                justRenderedList: false, 
                justRenderedItem: false, 
                forms: [
                    
                ], 
                current: {
                    status: 'list', 
                    selectedItem: null, 
                    scrollTop: 0, 
                    scrollingElement: null, 
                    justRenderedList: false, 
                    depth: 0, 
                    title: 'Autori'
                }
            };
            componentDidMount() {
                window.addEventListener('scroll', this.handlePaperScroll);
                this.props.onChangeCurrent(this.state.current, this.handleAuthorClose, this.handleChangeSearch);
            }
            componentWillUnmount() {
                window.removeEventListener('scroll', this.handlePaperScroll);
            }
            componentDidUpdate(prevProps, prevState) {
                if (this.state.current.justRenderedList) {
                    if (this.state.current.scrollingElement) {
                        this.state.current.scrollingElement.scrollTo(0, this.state.current.scrollTop);
                        this.setState((prevState) => {
                            return {
                                    ...prevState, 
                                    current: {
                                        ...prevState.current, 
                                        justRenderedList: false
                                    }
                                };
                        });
                    }
                }
                if (this.state.current.justRenderedItem) {
                    if (this.state.current.scrollingElement) {
                        this.state.current.scrollingElement.scrollTo(0, 0);
                        this.setState((prevState) => {
                            return {
                                    ...prevState, 
                                    current: {
                                        ...prevState.current, 
                                        justRenderedItem: false
                                    }
                                };
                        });
                    }
                }
            }
            handlePaperScroll = (ev) => {
                if (this.state.current.status == 'list') {
                    if (ev.target.scrollingElement) {
                        this.setState((prevState) => {
                            return {
                                    ...prevState, 
                                    current: {
                                        ...prevState.current, 
                                        scrollTop: event.target.scrollingElement.scrollTop, 
                                        scrollingElement: event.target.scrollingElement
                                    }
                                };
                        });
                    }
                }
            }
            handleAuthorClose = () => {
                this.setState((prevState) => {
                    var current = prevState.forms.pop();
                    if (current.status == 'list') {
                        current.justRenderedList = true;
                        current.depth = prevState.forms.length;
                        current.title = 'Autori';
                        current.selectedItem = null;
                    }
                    this.props.onChangeCurrent(current, this.handleAuthorClose, this.handleChangeSearch);
                    return {
                            ...prevState, 
                            current: current
                        };
                });
            }
            handleChangeSearch = (ev) => {
                var search = ev.target.value;
                this.setState((prevState) => {
                    return {
                            ...prevState, 
                            current: {
                                ...prevState.current, 
                                searchText: search
                            }
                        };
                });
            }
            handleAuthorOpen = (ev, selectedItem) => {
                // log 'handleAuthorOpen.id', selectedItem.id
                // log 'handleAuthorOpen.ev', ev
                this.setState((prevState) => {
                    console.log('handleAuthorOpen');
                    prevState.forms.push(prevState.current);
                    var current = {
                        ...prevState.current, 
                        status: 'author', 
                        selectedItem: selectedItem, 
                        depth: prevState.forms.length, 
                        title: (selectedItem.title && selectedItem.title.text) || selectedItem.id, 
                        justRenderedItem: true
                    };
                    this.props.onChangeCurrent(current, this.handleAuthorClose, this.handleChangeSearch);
                    console.log('onChangeCurrent called');
                    return {
                            ...prevState, 
                            current: current
                        };
                });
            }
            render() {
                const {
                    classes,
                    jsonData
                } = this.props;
                const {
                    status, 
                    selectedItem, 
                    searchText
                } = this.state.current;
                return  (
                        <div>
                            <Paper style={{maxHeight: '90%', maxWidth:800, padding:10, overflow: 'auto'}}>
                            {
                                status == 'list' &&  (
                                    <div>
                                    {
                                        jsonData.authors.sort(compareById).map((item) => {
                                            if ((!searchText || searchText.length == 0) || item.id.indexOf(searchText) > -1) {
                                                return  (
                                                        <AuthorListItem key={item.id} item={item} classes={classes} onClick={this.handleAuthorOpen}>
                                                        </AuthorListItem>
                                                    )
                                                ;
                                            }
                                        })
                                    }</div>
                                )
                                
                            }{
                                status == 'author' &&  (
                                    <div>
                                        <Author item={selectedItem} jsonData={jsonData}>
                                        </Author>
                                    
                                    </div>
                                )
                                
                            }</Paper>
                        
                        </div>
                    )
                ;
            }
        }
        function AuthorListItem(props) {
            var {item, onClick, classes} = props;
            var {id, name, title} = item;
            title = (title || name);
            return  (
                    <div onClick={(event) =>
                        onClick(event, item)}>
                        <div className="a-img-box-list">
                            <img src={item.avatar} className="a-img-list">
                            </img>
                        
                        </div>
                    
                        <div className="li-title">
                            <span>
                            {item.fullname}
                            </span>
                        
                        </div>
                    
                        <div className="li-id">
                            <div>
                            id: {item.id}
                            </div>
                        
                        </div>
                    
                        <div className="li-clear">
                        </div>
                    
                    </div>
                )
            ;
        }
        function Author(props) {
            var {item} = props;
            return  (
                    <div>
                        <div>
                            <div className="a-d-img">
                                <img src={item.avatar} height={160} width={140}>
                                </img>
                            
                            </div>
                        
                            <div className="a-d-born">
                            {
                                item.born ?  (
                                        <div>
                                            <div className="li-clear">
                                            </div>
                                        
                                            <div className="a-d-born-label">
                                            Nascita
                                            </div>
                                        
                                            <div className="a-d-born-text">
                                                <span>
                                                {item.born.date}
                                                </span>
                                            
                                                <span>
                                                ,&nbsp;
                                                </span>
                                            
                                                <span>
                                                {item.born.place}
                                                </span>
                                            
                                            </div>
                                        
                                        </div>
                                    )
                                 : null
                                
                            }{
                                item.died ?  (
                                        <div>
                                            <div className="li-clear">
                                            </div>
                                        
                                            <div className="a-d-born-label">
                                            Morte
                                            </div>
                                        
                                            <div className="a-d-born-text">
                                                <span>
                                                {item.died.date}
                                                </span>
                                            
                                                <span>
                                                ,&nbsp;
                                                </span>
                                            
                                                <span>
                                                {item.died.place}
                                                </span>
                                            
                                            </div>
                                        
                                        </div>
                                    )
                                 : null
                                
                            }</div>
                        
                            <div className="li-clear">
                            </div>
                        
                        </div>
                    
                        <ContentText item={item}>
                        </ContentText>
                    
                    </div>
                )
            ;
        }
        function GroupList(props) {
            var {jsonData} = props;
            return  (
                    <div>
                        <h2>
                        Gruppi
                        </h2>
                    
                        <Paper style={{maxHeight: 370, overflow: 'auto'}}>
                            <Table>
                            {
                                jsonData.authorsGroups.sort(compareById).map(function(item) {
                                    return  (
                                            <TableRow button key={item.id}>
                                                <TableCell>
                                                    <h3>
                                                    {item.id}
                                                    </h3>
                                                
                                                    <ContentText item={item}>
                                                    </ContentText>
                                                
                                                </TableCell>
                                            
                                            </TableRow>
                                        )
                                    ;
                                })
                            }</Table>
                        
                        </Paper>
                    
                    </div>
                )
            ;
        }
        function Group(props) {
            var {item} = props;
            return  (
                    <div>
                        <h3>
                        {item.id}
                        </h3>
                    
                        <ContentText item={item}>
                        </ContentText>
                    
                    </div>
                )
            ;
        }
        function PlaceList(props) {
            var {jsonData} = props;
            return  (
                    <div>
                        <h2>
                        Luoghi
                        </h2>
                    
                        <Paper style={{maxHeight: 370, overflow: 'auto'}}>
                            <Table>
                            {
                                jsonData.theories.sort(compareById).map(function(item) {
                                    return  (
                                            <TableRow button key={item.id}>
                                                <TableCell>
                                                    <h3>
                                                    {item.id}
                                                    </h3>
                                                
                                                    <ContentText item={item}>
                                                    </ContentText>
                                                
                                                </TableCell>
                                            
                                            </TableRow>
                                        )
                                    ;
                                })
                            }</Table>
                        
                        </Paper>
                    
                    </div>
                )
            ;
        }
        function Place(props) {
            var {item} = props;
            return  (
                    <div>
                        <h3>
                        {item.id}
                        </h3>
                    
                        <ContentText item={item}>
                        </ContentText>
                    
                    </div>
                )
            ;
        }
        class PublicationList extends React.Component {
            state = {
                status: 'list', 
                selectedItem: null, 
                forms: [
                    
                ], 
                current: {
                    status: 'list', 
                    selectedItem: null, 
                    scrollTop: 0, 
                    scrollingElement: null, 
                    justRenderedList: false, 
                    justRenderedItem: false, 
                    depth: 0, 
                    title: 'Testi'
                }
            };
            state = {
                status: 'list', 
                selectedItem: null, 
                scrollTop: 0, 
                scrollingElement: null, 
                justRenderedList: false, 
                justRenderedItem: false, 
                forms: [
                    
                ], 
                current: {
                    status: 'list', 
                    selectedItem: null, 
                    scrollTop: 0, 
                    scrollingElement: null, 
                    justRenderedList: false, 
                    depth: 0, 
                    title: 'Testi'
                }
            };
            componentDidMount() {
                window.addEventListener('scroll', this.handlePaperScroll);
                this.props.onChangeCurrent(this.state.current, this.handlePubblicationsClose, this.handleChangeSearch);
            }
            componentWillUnmount() {
                window.removeEventListener('scroll', this.handlePaperScroll);
            }
            componentDidUpdate(prevProps, prevState) {
                if (this.state.current.justRenderedList) {
                    if (this.state.current.scrollingElement) {
                        this.state.current.scrollingElement.scrollTo(0, this.state.current.scrollTop);
                        this.setState((prevState) => {
                            return {
                                    ...prevState, 
                                    current: {
                                        ...prevState.current, 
                                        justRenderedList: false
                                    }
                                };
                        });
                    }
                }
                if (this.state.current.justRenderedItem) {
                    if (this.state.current.scrollingElement) {
                        this.state.current.scrollingElement.scrollTo(0, 0);
                        this.setState((prevState) => {
                            return {
                                    ...prevState, 
                                    current: {
                                        ...prevState.current, 
                                        justRenderedItem: false
                                    }
                                };
                        });
                    }
                }
            }
            handlePaperScroll = (ev) => {
                if (this.state.current.status == 'list') {
                    if (ev.target.scrollingElement) {
                        this.setState((prevState) => {
                            return {
                                    ...prevState, 
                                    current: {
                                        ...prevState.current, 
                                        scrollTop: event.target.scrollingElement.scrollTop, 
                                        scrollingElement: event.target.scrollingElement
                                    }
                                };
                        });
                    }
                }
            }
            handlePubblicationsClose = () => {
                this.setState((prevState) => {
                    var current = prevState.forms.pop();
                    if (current.status == 'list') {
                        current.justRenderedList = true;
                        current.depth = prevState.forms.length;
                        current.title = 'Testi';
                        current.selectedItem = null;
                    }
                    this.props.onChangeCurrent(current, this.handlePubblicationsClose, this.handleChangeSearch);
                    return {
                            ...prevState, 
                            current: current
                        };
                });
            }
            handleChangeSearch = (ev) => {
                var search = ev.target.value;
                this.setState((prevState) => {
                    return {
                            ...prevState, 
                            current: {
                                ...prevState.current, 
                                searchText: search
                            }
                        };
                });
            }
            handleOpen = (status, item) => {
                this.setState((prevState) => {
                    prevState.forms.push(prevState.current);
                    var current = {
                        ...prevState.current, 
                        status: status, 
                        selectedItem: item, 
                        depth: prevState.forms.length, 
                        title: (item.title && item.title.text) || item.id, 
                        justRenderedItem: true
                    };
                    this.props.onChangeCurrent(current, this.handlePubblicationsClose, this.handleChangeSearch);
                    return {
                            ...prevState, 
                            current: current
                        };
                });
            }
            handleArticleOpen = (ev, articleItem) => {
                this.handleOpen('article', articleItem);
            }
            handleBookOpen = (ev, bookItem) => {
                this.handleOpen('book', bookItem);
            }
            render() {
                const {
                    jsonData
                } = this.props;
                const {
                    status, 
                    selectedItem, 
                    searchText
                } = this.state.current;
                var titleText = selectedItem ? dbExtractTitleText(selectedItem.title) || name : '';
                return  (
                        <div>
                        {
                            status == 'list' &&  (
                                <div>
                                    <Paper style={{maxHeight: '90%', maxWidth:800, padding:10, overflow: 'auto'}}>
                                        <h2>
                                        Articoli
                                        </h2>
                                    
                                    {
                                        jsonData.articles.sort(compareByDatePub).map((item) => {
                                            if ((!searchText || searchText.length == 0) || item.id.indexOf(searchText) > -1) {
                                                return  (
                                                        <div key={item.id}>
                                                            <ArticleListItem item={item} onClick={this.handleArticleOpen}>
                                                            </ArticleListItem>
                                                        
                                                        </div>
                                                    )
                                                ;
                                            }
                                        })
                                    }<h2>
                                        Libri
                                        </h2>
                                    
                                    {
                                        jsonData.books.sort(compareByDatePub).map((item) => {
                                            if ((!searchText || searchText.length == 0) || item.id.indexOf(searchText) > -1) {
                                                return  (
                                                        <div key={item.id}>
                                                            <BookListItem item={item} onClick={this.handleBookOpen}>
                                                            </BookListItem>
                                                        
                                                        </div>
                                                    )
                                                ;
                                            }
                                        })
                                    }</Paper>
                                
                                </div>
                            )
                            
                        }{
                            status == 'book' &&  (
                                <div>
                                    <Book item={selectedItem} jsonData={jsonData}>
                                    </Book>
                                
                                </div>
                            )
                            
                        }{
                            status == 'article' &&  (
                                <div>
                                    <Article item={selectedItem} jsonData={jsonData}>
                                    </Article>
                                
                                </div>
                            )
                            
                        }</div>
                    )
                ;
            }
        }
        function ArticleListItem(props) {
            var {item, onClick} = props;
            var {id, name, title} = item;
            var titleText = dbExtractTitleText(title) || name;
            var datePub = item.datepub == '9999/99/99' ? '' : '(' + item.datepub + ')';
            return  (
                    <div onClick={(event) =>
                        onClick(event, item)}>
                        <div className="li-title">
                        {titleText} {datePub}
                        </div>
                    
                        <div className="li-id">
                        id: {id}
                        </div>
                    
                        <div className="li-clear">
                        </div>
                    
                    </div>
                )
            ;
        }
        function Article(props) {
            var {item, jsonData} = props;
            var bookObj = dbGetBook(item.book, jsonData);
            var titleText = dbExtractTitleText(item.title) || 'no title';
            var bookTitleText = bookObj ? dbExtractTitleText(bookObj.title) || name : '';
            var quotes = dbGetArticleQuotes(item.id, jsonData);
            return  (
                    <div>
                        <div>
                            <Paper className="info-box">
                                <InfoItem label='id' text={item.id}>
                                </InfoItem>
                            
                                <InfoItem label='titolo' text={titleText}>
                                </InfoItem>
                            
                                <PublicationAuthors item={item} jsonData={jsonData}>
                                </PublicationAuthors>
                            
                                <InfoItem label='data pubblicazione' text={item.datepub}>
                                </InfoItem>
                            
                            {
                                item.edition &&  (
                                    <InfoItem label='edizione' text={item.edition}>
                                    </InfoItem>
                                )
                                
                            }{
                                bookObj &&  (
                                    <InfoItem label='nel libro' text={bookTitleText}>
                                    </InfoItem>
                                )
                                
                            }{
                                item.url &&  (
                                    <InfoUrl label='link' url={item.url}>
                                    </InfoUrl>
                                )
                                
                            }</Paper>
                        
                        </div>
                    
                        <ContentText item={item} jsonData={jsonData}>
                        </ContentText>
                    
                    {
                        item.abstract &&  (
                            <Paper className="abstract-box">
                                <div className="abstract-title">
                                abstract
                                </div>
                            
                                <div>
                                    <ContentText item={item.abstract} jsonData={jsonData}>
                                    </ContentText>
                                
                                </div>
                            
                            </Paper>
                        )
                        
                    }{
                        quotes.length > 0 &&  (
                            <Paper className="quotes-box">
                                <div className="quotes-title">
                                citazioni
                                </div>
                            
                                <div>
                                {
                                    quotes.sort(compareQuotes).map((quote, i) => {
                                        return  (
                                                <div key={i}>
                                                    <div className="quotes-concept-id">
                                                    concetto {quote.concept.id}
                                                    </div>
                                                
                                                    <Quote item={quote.quote} jsonData={jsonData}>
                                                    </Quote>
                                                
                                                </div>
                                            )
                                        ;
                                    })
                                }</div>
                            
                            </Paper>
                        )
                        
                    }</div>
                )
            ;
        }
        function BookListItem(props) {
            var {item, onClick} = props;
            var {id, name, title} = item;
            title = (title || name);
            var titleText = dbExtractTitleText(title) || name;
            var datePub = item.datepub == '9999/99/99' ? '' : '(' + item.datepub + ')';
            return  (
                    <div onClick={(event) =>
                        onClick(event, item)}>
                        <div className="li-title">
                        {titleText} {datePub}
                        </div>
                    
                        <div className="li-id">
                        id: {id}
                        </div>
                    
                        <div className="li-clear">
                        </div>
                    
                    </div>
                )
            ;
        }
        function Book(props) {
            var {item, jsonData} = props;
            var titleText = dbExtractTitleText(item.title) || name;
            return  (
                    <div>
                        <div>
                            <Paper className="info-box">
                                <InfoItem label='id' text={item.id}>
                                </InfoItem>
                            
                                <InfoItem label='titolo' text={titleText}>
                                </InfoItem>
                            
                                <PublicationAuthors item={item} jsonData={jsonData}>
                                </PublicationAuthors>
                            
                                <InfoItem label='data pubblicazione' text={item.datepub}>
                                </InfoItem>
                            
                            {
                                item.edition &&  (
                                    <InfoItem label='edizione' text={item.edition}>
                                    </InfoItem>
                                )
                                
                            }{
                                item.url &&  (
                                    <InfoUrl label='link' url={item.url}>
                                    </InfoUrl>
                                )
                                
                            }</Paper>
                        
                        </div>
                    
                        <ContentText item={item} jsonData={jsonData}>
                        </ContentText>
                    
                    </div>
                )
            ;
        }
        function PublicationAuthors(props) {
            var {item, jsonData} = props;
            var text = '';
            item.authors.map((token, i) => {
                var authObj = dbGetAuthor(token, jsonData);
                text += (i > 0 ? ', ' : '');
                if (authObj) {
                    text += (i > 0 ? ', ' : '') + authObj.fullname;
                }
                else {
                    text += token;
                }
            });
            return  (
                    <InfoItem label='autore' text={text}>
                    </InfoItem>
                )
            ;
        }
        function InfoItem(props) {
            var {label, text} = props;
            return  (
                    <div className='info-item-box'>
                        <span className='info-item-label'>
                        {label}
                        </span>
                    
                        <span>
                        &nbsp; : &nbsp;
                        </span>
                    
                        <span className='info-item-text'>
                        {text}
                        </span>
                    
                    </div>
                )
            ;
        }
        function InfoUrl(props) {
            var {label, url} = props;
            return  (
                    <div className='info-item-box'>
                        <span className='info-item-label'>
                        {label}
                        </span>
                    
                        <span>
                        &nbsp; : &nbsp;
                        </span>
                    
                        <span className='info-item-url'>
                            <a href={url} target="_blank" rel="noopener noreferrer">
                            {url}
                            </a>
                        
                        </span>
                    
                    </div>
                )
            ;
        }
        const styles = theme => (
            {
                root: {
                    display: 'flex'
                }, 
                appBar: {
                    transition: theme.transitions.create([
                        'margin', 
                        'width'
                    ], {
                        easing: theme.transitions.easing.sharp, 
                        duration: theme.transitions.duration.leavingScreen
                    })
                }, 
                appBarShift: {
                    width: `calc(100% - ${drawerWidth}px)`, 
                    marginLeft: drawerWidth, 
                    transition: theme.transitions.create([
                        'margin', 
                        'width'
                    ], {
                        easing: theme.transitions.easing.easeOut, 
                        duration: theme.transitions.duration.enteringScreen
                    })
                }, 
                menuButton: {
                    marginLeft: 12, 
                    marginRight: 20
                }, 
                hide: {
                    display: 'none'
                }, 
                drawer: {
                    width: drawerWidth, 
                    flexShrink: 0
                }, 
                drawerPaper: {
                    width: drawerWidth
                }, 
                drawerHeader: {
                    display: 'flex', 
                    alignItems: 'center', 
                    padding: '0 8px', 
                    ...theme.mixins.toolbar, 
                    justifyContent: 'flex-end'
                }, 
                title: {
                    flexGrow: 1
                }, 
                db: {
                    padding: '0 20px'
                }, 
                content: {
                    flexGrow: 1, 
                    padding: theme.spacing.unit * 3, 
                    transition: theme.transitions.create('margin', {
                        easing: theme.transitions.easing.sharp, 
                        duration: theme.transitions.duration.leavingScreen
                    }), 
                    marginLeft: -drawerWidth
                }, 
                contentShift: {
                    transition: theme.transitions.create('margin', {
                        easing: theme.transitions.easing.easeOut, 
                        duration: theme.transitions.duration.enteringScreen
                    }), 
                    marginLeft: 0
                }, 
                philos: {
                    fontSize: '2em', 
                    fontWeight: '700'
                }, 
                search: {
                    position: 'relative', 
                    borderRadius: theme.shape.borderRadius, 
                    backgroundColor: fade(theme.palette.common.white, 0.15), 
                    '&:hover': {
                        backgroundColor: fade(theme.palette.common.white, 0.25)
                    }, 
                    marginLeft: 0, 
                    width: '100%', 
                    [theme.breakpoints.up('sm')]: {
                        marginLeft: theme.spacing(1), 
                        width: 'auto'
                    }
                }, 
                searchIcon: {
                    padding: theme.spacing(0, 2), 
                    height: '100%', 
                    position: 'absolute', 
                    pointerEvents: 'none', 
                    display: 'flex', 
                    alignItems: 'center', 
                    justifyContent: 'center'
                }, 
                inputRoot: {
                    color: 'inherit'
                }, 
                inputInput: {
                    padding: theme.spacing(1, 1, 1, 0), 
                    paddingLeft: `calc(1em + ${theme.spacing(4)}px)`, 
                    transition: theme.transitions.create('width'), 
                    width: '100%', 
                    [theme.breakpoints.up('sm')]: {
                        
                    }, 
                    width: '12ch', 
                    '&:focus': {
                        width: '20ch'
                    }
                }
            });
        
        class Index extends React.Component {
            state = {
                isLoading: true, 
                jsonData: {}, 
                error: null, 
                open: true, 
                selectedView: 'Autori', 
                selectedTitle: '', 
                showArrowBack: false, 
                onArrowBack: null
            };
            handleDrawerOpen = () => {
                this.setState((prevState) => {
                    return {
                            ...prevState, 
                            open: true
                        };
                });
            }
            handleDrawerClose = () => {
                this.setState((prevState) => {
                    return {
                            ...prevState, 
                            open: false
                        };
                });
            }
            handleSelectView = (event, name) => {
                this.setState((prevState) => {
                    return {
                            ...prevState, 
                            selectedView: name, 
                            open: false
                        };
                });
            }
            handleChangeCurrent = (current, onArrowBack, onChangeSearch) => {
                this.setState((prevState) => {
                    return {
                            ...prevState, 
                            showArrowBack: current.depth > 0, 
                            selectedTitle: current.title, 
                            onArrowBack: onArrowBack, 
                            onChangeSearch: onChangeSearch
                        };
                });
            }
            handleArrowBack = () => {
                if (this.state.onArrowBack) {
                    this.state.onArrowBack();
                }
            }
            handleChangeSearch = (ev) => {
                if (this.state.onChangeSearch) {
                    this.state.onChangeSearch(ev);
                }
            }
            componentDidMount() {
                if (false) {
                    this.setState({
                        jsonData: jsonData, 
                        isLoading: false, 
                        error: null
                    });
                }
                else {
                    loadJSON("./json/first.philos.extended.json", (response) => {
                        var jsonresponse = JSON.parse(response);
                        // log 'from did mount', jsonresponse
                        this.setState((prevState) => {
                            return {
                                    ...prevState, 
                                    jsonData: jsonresponse, 
                                    isLoading: false, 
                                    error: null
                                };
                        });
                    });
                }
            }
            render() {
                const {
                    classes,
                    theme,
                    
                } = this.props;
                const {
                    isLoading, 
                    jsonData, 
                    error, 
                    open, 
                    selectedView, 
                    selectedTitle, 
                    showArrowBack
                } = this.state;
                const dbTitle = 'Freud';
                return  (
                        <div className={classes.root}>
                            <CssBaseline>
                            </CssBaseline>
                        
                            <AppBar position="fixed" className={classNames(classes.appBar, {
                                [classes.appBarShift]: open
                            })}>
                                <Toolbar disableGutters={!open}>
                                    <IconButton color="inherit" aria-label="Open drawer" onClick={this.handleDrawerOpen} className={classNames(classes.menuButton, open && classes.hide)}>
                                        <Icon>
                                        menu</Icon>
                                    
                                    </IconButton>
                                
                                {
                                    showArrowBack &&  (
                                        <IconButton color="inherit" aria-label="Go back" onClick={this.handleArrowBack} className={classNames(classes.menuButton)}>
                                            <Icon>
                                            arrow_back</Icon>
                                        
                                        </IconButton>
                                    )
                                    
                                }<Typography variant="h6" color="inherit" noWrap edge="end" className={classes.title}>
                                    {selectedTitle}</Typography>
                                
                                    <div className={classes.search}>
                                        <div className={classes.searchIcon}>
                                            <Icon>
                                            search</Icon>
                                        
                                        </div>
                                    
                                        <InputBase placeholder="Search…" classes={{root: classes.inputRoot, input: classes.inputInput,}} inputProps={{ 'aria-label': 'search' }} onChange={this.handleChangeSearch}>
                                        </InputBase>
                                    
                                    </div>
                                
                                    <Typography variant="h6" color="inherit" noWrap edge="end" className={classes.db}>
                                    {dbTitle} DB</Typography>
                                
                                </Toolbar>
                            
                            </AppBar>
                        
                            <Drawer className={classes.drawer} variant="persistent" anchor="left" open={open} classes={{
                                paper: classes.drawerPaper
                            }}>
                                <div className={classes.drawerHeader}>
                                    <span className={classes.philos}>
                                    PHILOS
                                    </span>
                                
                                    <IconButton onClick={this.handleDrawerClose}>
                                    {
                                        theme.direction === 'ltr' ?  (
                                                <Icon>
                                                chevron_left</Icon>
                                            )
                                         :  (
                                                <Icon>
                                                chevron_right</Icon>
                                            )
                                        
                                    }</IconButton>
                                
                                </div>
                            
                                <Divider>
                                </Divider>
                            
                                <List>
                                {
                                    [
                                        'Materie', 
                                        'Correnti', 
                                        'Teorie', 
                                        'Concetti', 
                                        'Autori', 
                                        'Gruppi', 
                                        'Luoghi', 
                                        'Testi'
                                    ].map((text, index) =>  (
                                            <ListItem button key={text} disabled={selectedView == text || ['Concetti', 'Autori', 'Testi'].indexOf(text) < 0} onClick={(event) =>
                                                this.handleSelectView(event, text)}>
                                                <ListItemIcon>
                                                {
                                                    index % 2 === 0 ?  (
                                                            <Icon>
                                                            inbox</Icon>
                                                        )
                                                     :  (
                                                            <Icon>
                                                            mail</Icon>
                                                        )
                                                    
                                                }</ListItemIcon>
                                            
                                                <ListItemText primary={text}>
                                                </ListItemText>
                                            
                                            </ListItem>
                                        )
                                    )
                                }</List>
                            
                                <Divider>
                                </Divider>
                            
                                <List>
                                {
                                    [
                                        'Panoramica', 
                                        'Schema'
                                    ].map((text, index) =>  (
                                            <ListItem button key={text} disabled={[].indexOf(text) < 0} onClick={(event) =>
                                                this.handleSelectView(event, text)}>
                                                <ListItemIcon>
                                                {
                                                    index % 2 === 0 ?  (
                                                            <Icon>
                                                            inbox</Icon>
                                                        )
                                                     :  (
                                                            <Icon>
                                                            mail</Icon>
                                                        )
                                                    
                                                }</ListItemIcon>
                                            
                                                <ListItemText primary={text}>
                                                </ListItemText>
                                            
                                            </ListItem>
                                        )
                                    )
                                }</List>
                            
                            </Drawer>
                        
                            <main className={classNames(classes.content, {
                                [classes.contentShift]: open
                            })}>
                            {
                                !(isMobile() && open == false) &&  (
                                    <div>
                                        <div className={classes.drawerHeader}>
                                        </div>
                                    
                                    {
                                        selectedView == 'Panoramica' &&  (
                                            <p>
                                            Panoramica
                                            </p>
                                        )
                                        
                                    }{
                                        selectedView == 'Schema' &&  (
                                            <p>
                                            Schema
                                            </p>
                                        )
                                        
                                    }{
                                        selectedView == 'Materie' && isLoading == false &&  (
                                            <FieldList jsonData={jsonData}>
                                            </FieldList>
                                        )
                                        
                                    }{
                                        selectedView == 'Correnti' && isLoading == false &&  (
                                            <SchoolList jsonData={jsonData}>
                                            </SchoolList>
                                        )
                                        
                                    }{
                                        selectedView == 'Teorie' && isLoading == false &&  (
                                            <TheoryList jsonData={jsonData}>
                                            </TheoryList>
                                        )
                                        
                                    }{
                                        selectedView == 'Concetti' && isLoading == false &&  (
                                            <ConceptList jsonData={jsonData} onChangeCurrent={this.handleChangeCurrent}>
                                            </ConceptList>
                                        )
                                        
                                    }{
                                        selectedView == 'Autori' && isLoading == false &&  (
                                            <AuthorList jsonData={jsonData} onChangeCurrent={this.handleChangeCurrent}>
                                            </AuthorList>
                                        )
                                        
                                    }{
                                        selectedView == 'Gruppi' && isLoading == false &&  (
                                            <GroupList jsonData={jsonData}>
                                            </GroupList>
                                        )
                                        
                                    }{
                                        selectedView == 'Luoghi' && isLoading == false &&  (
                                            <PlaceList jsonData={jsonData}>
                                            </PlaceList>
                                        )
                                        
                                    }{
                                        selectedView == 'Testi' && isLoading == false &&  (
                                            <PublicationList jsonData={jsonData} onChangeCurrent={this.handleChangeCurrent}>
                                            </PublicationList>
                                        )
                                        
                                    }</div>
                                )
                                
                            }</main>
                        
                        </div>
                    )
                ;
            }
        }
        const App = withStyles(styles, { withTheme: true })(Index);
        ReactDOM.render(
            <App>
            </App>
        , document.getElementById('root'));
    </script>
</body>

</html>
